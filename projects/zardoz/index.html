<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>Zardoz - apiercey.github.io</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=icon href=/favicon.png>
<link rel=stylesheet href=/css/style.min.4b2bfb3701049fe0da3e8d6b9d15186ba1dc7e294f0be3e2bca21bb8a330f5dd.css>
<meta name=description content="&#34;Go forth and test!&#34; - A Golang testing framework for testing asyncronous dependencies.">
<meta property="og:title" content="Zardoz">
<meta property="og:type" content="website">
<meta property="og:url" content="/projects/zardoz/">
<meta property="og:image" content="/images/zardoz.jpg">
<meta property="og:description" content="&#34;Go forth and test!&#34; - A Golang testing framework for testing asyncronous dependencies.">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@example">
<meta name=twitter:creator content="@example">
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel=stylesheet>
</head>
<body class="page page-default-single">
<div id=wrapper class=wrapper>
<div class=header>
<a class=header-logo href=/>apiercey.github.io</a>
<div class=menu-main>
<ul>
<li class=menu-item-about>
<a href=/pages/about/>About</a>
</li>
<li class=menu-item-articles>
<a href=/articles/>Articles</a>
</li>
<li class=menu-item-posts>
<a href=/posts/>Posts</a>
</li>
<li class=menu-item-projects>
<a href=/projects/>Projects</a>
</li>
</ul>
</div>
</div>
<div class=intro>
<h1>Zardoz<span class=dot>.</span></h1>
<img src=/images/zardoz.jpg>
</div>
<div class=content>
<h1 id=zardoz>ZARDOZ</h1>
<p><a href=https://github.com/APiercey/zardoz>A Golang testing framework</a> for testing asyncronous dependencies.</p>
<h1 id=table-of-contents>Table of Contents</h1>
<ul>
<li><a href=#installation>Installation</a></li>
<li><a href=#usage>Usage</a>
<ul>
<li><a href=#test>Test</a></li>
<li><a href=#assertions>Assertions</a>
<ul>
<li><a href=#tassert>t.Assert</a></li>
<li><a href=#tassertsync>t.AssertSync</a></li>
<li><a href=#tassertasync>t.AssertAsync</a></li>
</ul>
</li>
<li><a href=#working-example>Working Example</a></li>
</ul>
</li>
<li><a href=#reading-results>Reading results</a></li>
<li><a href=#setup-and-cleanup>Setup and Cleanup</a></li>
</ul>
<h2 id=installation>Installation</h2>
<p>Pull the module into your GOPATH using</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>apiercey</span><span class=o>/</span><span class=nx>zardoz</span>
</code></pre></div><h2 id=usage>Usage</h2>
<p>ZARDOZ can be imported like so:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=nx>z</span> <span class=s>&#34;github.com/APiercey/zardoz&#34;</span>
</code></pre></div><p>ZARDOZ comes with <a href=https://github.com/APiercey/zardoz/tree/main#assertions>three assertions</a> for testing asyncronous dependencies. Test blocks begin with a <code>Describe</code> block, which provides a test suite.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=nx>z</span><span class=p>.</span><span class=nf>Describe</span><span class=p>(</span><span class=s>&#34;Example External System&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Suite</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;can turn lights on&#34;</span><span class=p>,</span> <span class=nx>test_light_turn_on</span><span class=p>)</span>
  <span class=p>})</span>
<span class=p>}</span>
</code></pre></div><h3 id=test>Test</h3>
<p>A test can be written using anonymous functions or by passing in the function name to the describe block. The function will receive a Test struct, which provides assertions.</p>
<p>Examples:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=kd>func</span> <span class=nf>test_lego_car_turns_left</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Test</span><span class=p>)</span> <span class=p>{</span>
    <span class=nf>execute_turn_left_command</span><span class=p>()</span>

    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nf>evaluate_lego_car_turned_left</span><span class=p>()</span>
    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>}</span>

<span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;can turn left&#34;</span><span class=p>,</span> <span class=nx>test_lego_car_turns_left</span><span class=p>)</span>
</code></pre></div><p>or simply</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;can turn left&#34;</span><span class=p>,</span> <span class=kd>func</span> <span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Test</span><span class=p>)</span> <span class=p>{</span>
    <span class=nf>execute_turn_left_command</span><span class=p>()</span>

    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nf>evaluate_lego_car_turned_left</span><span class=p>()</span>
    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>})</span>

</code></pre></div><h3 id=assertions>Assertions</h3>
<p>ZARDOZ provides three assertions:</p>
<ul>
<li><code>t.Assert</code> asserts a value is true immediatly.</li>
<li><code>t.AssertSync</code> assert a condition will become true.</li>
<li><code>t.AssertAsync</code> asserts a condition will become true and can be parallelized with other Assert calls.</li>
</ul>
<h4 id=tassert>t.Assert</h4>
<p>Simple assertions like in other unit testing frameworks.</p>
<p>Examples</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=nx>t</span><span class=p>.</span><span class=nf>Assert</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=c1>// passes
</span><span class=c1></span><span class=nx>t</span><span class=p>.</span><span class=nf>Assert</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span> <span class=c1>// fails
</span><span class=c1></span><span class=nx>t</span><span class=p>.</span><span class=nf>Assert</span><span class=p>(</span><span class=nf>some_func_that_returns_boolean</span><span class=p>())</span> <span class=c1>// depends on the returned value
</span></code></pre></div><h4 id=tassertsync>t.AssertSync</h4>
<p>Asserts something will eventually true. It expects two values: a predict function that compares for a condition and a timeout of how long it should attempt to assert this condition. Timeout values are in milliseconds.</p>
<p>If the predict should return <em>false</em> it will try again.</p>
<p>Multiple <code>t.AssertSync</code> assertions result will assert their conditions syncronously.</p>
<p>Examples</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=kc>true</span>
<span class=p>},</span> <span class=mi>1_000</span><span class=p>)</span> 

<span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nf>maybe_returns_true</span><span class=p>()</span>
<span class=p>},</span> <span class=mi>1_000</span><span class=p>)</span> 

<span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=nx>maybe_returns_true</span><span class=p>,</span> <span class=mi>1_000</span><span class=p>)</span> 
</code></pre></div><p>In the example above, the test will take a maximum time of 3000ms to complete if all assertions are false.</p>
<h4 id=tassertasync>t.AssertAsync</h4>
<p>Asserts something will eventually be true. It expects two values: a predict function that compares for a condition and a timeout of how long it should attempt to assert this condition. Timeout values are in milliseconds.</p>
<p>If the predict should return <em>false</em> it will try again.</p>
<p>Multiple <code>t.AssertSync</code> assertions result will assert their conditions asyncronously and can be used to observe conditions which take place within the same time frame.</p>
<p>Examples</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=nx>t</span><span class=p>.</span><span class=nf>AssertAsync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=kc>true</span>
<span class=p>},</span> <span class=mi>1_000</span><span class=p>)</span> 

<span class=nx>t</span><span class=p>.</span><span class=nf>AssertAsync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
  <span class=k>return</span> <span class=nf>maybe_returns_true</span><span class=p>()</span>
<span class=p>},</span> <span class=mi>1_000</span><span class=p>)</span> 

<span class=nx>t</span><span class=p>.</span><span class=nf>AssertAsync</span><span class=p>(</span><span class=nx>maybe_returns_true</span><span class=p>,</span> <span class=mi>1_000</span><span class=p>)</span> 
</code></pre></div><p>In the example above, the test will take a maximum time of roughly 1000ms to complete if all assertions are false.</p>
<h3 id=working-example>Working Example</h3>
<p>Below is an example of testing IoT device using the MQTT protocol. The suite will send messaeges to a device and expects an asynchronous response.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=kn>package</span> <span class=nx>main</span>

<span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
<span class=kn>import</span> <span class=nx>z</span> <span class=s>&#34;github.com/APiercey/zardoz&#34;</span>
<span class=kn>import</span> <span class=nx>mqtt</span> <span class=s>&#34;github.com/eclipse/paho.mqtt.golang&#34;</span>

<span class=c1>// Setup code for completness
</span><span class=c1></span><span class=kd>var</span> <span class=nx>connectLostHandler</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>ConnectionLostHandler</span> <span class=p>=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>client</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Unexpected connection lost: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
<span class=p>}</span>

<span class=c1>// Setup code for completness
</span><span class=c1></span><span class=kd>func</span> <span class=nf>setupMqttClient</span><span class=p>(</span><span class=nx>clientID</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>broker</span> <span class=p>=</span> <span class=s>&#34;localhost&#34;</span>
    <span class=kd>var</span> <span class=nx>port</span> <span class=p>=</span> <span class=mi>1883</span>

    <span class=nx>opts</span> <span class=o>:=</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nf>NewClientOptions</span><span class=p>()</span>
    <span class=nx>opts</span><span class=p>.</span><span class=nf>AddBroker</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;tcp://%s:%d&#34;</span><span class=p>,</span> <span class=nx>broker</span><span class=p>,</span> <span class=nx>port</span><span class=p>))</span>
    <span class=nx>opts</span><span class=p>.</span><span class=nf>SetClientID</span><span class=p>(</span><span class=s>&#34;test_runner&#34;</span><span class=p>)</span>
    <span class=nx>opts</span><span class=p>.</span><span class=nf>SetDefaultPublishHandler</span><span class=p>(</span><span class=kd>func</span><span class=p>(</span><span class=nx>client</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span> <span class=nx>msg</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span> <span class=p>{</span>
    <span class=p>})</span>
    <span class=nx>opts</span><span class=p>.</span><span class=nx>OnConnectionLost</span> <span class=p>=</span> <span class=nx>connectLostHandler</span>
    <span class=nx>client</span> <span class=o>:=</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=nx>opts</span><span class=p>)</span>

    <span class=k>if</span> <span class=nx>token</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Connect</span><span class=p>();</span> <span class=nx>token</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=nx>token</span><span class=p>.</span><span class=nf>Error</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
        <span class=nb>panic</span><span class=p>(</span><span class=nx>token</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=nx>client</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>test_falls_asleep_on_message</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Test</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>expect_to_fall_asleep</span> <span class=o>:=</span> <span class=kc>false</span>

    <span class=nx>client</span><span class=p>.</span><span class=nf>Subscribe</span><span class=p>(</span><span class=s>&#34;iot-device/output&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span> <span class=nx>m</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nb>string</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nf>Payload</span><span class=p>())</span> <span class=o>==</span> <span class=s>&#34;ASLEEP&#34;</span> <span class=p>{</span>
          <span class=nx>expect_to_fall_asleep</span> <span class=p>=</span> <span class=kc>true</span>
        <span class=p>}</span>
    <span class=p>}).</span><span class=nf>Wait</span><span class=p>()</span>

    <span class=nx>client</span><span class=p>.</span><span class=nf>Publish</span><span class=p>(</span><span class=s>&#34;iot-device/input&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;SLEEP&#34;</span><span class=p>)</span>

    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span> <span class=k>return</span> <span class=nx>expect_to_fall_asleep</span> <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>test_wakes_up_on_messages</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Test</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>expect_to_be_awake</span> <span class=o>:=</span> <span class=kc>false</span>
    <span class=nx>expect_to_download_config</span> <span class=o>:=</span> <span class=kc>false</span>

    <span class=nx>client</span><span class=p>.</span><span class=nf>Subscribe</span><span class=p>(</span><span class=s>&#34;iot-device/output&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span> <span class=nx>m</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=nb>string</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nf>Payload</span><span class=p>())</span> <span class=o>==</span> <span class=s>&#34;WOKEN_UP&#34;</span> <span class=p>{</span>
          <span class=nx>expect_to_be_awake</span> <span class=p>=</span> <span class=kc>true</span>
        <span class=p>}</span>
        
        <span class=k>if</span> <span class=nb>string</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nf>Payload</span><span class=p>())</span> <span class=o>==</span> <span class=s>&#34;CONFIG_DOWNLOADED&#34;</span> <span class=p>{</span>
          <span class=nx>expect_to_download_config</span> <span class=p>=</span> <span class=kc>true</span>
        <span class=p>}</span>
    <span class=p>}).</span><span class=nf>Wait</span><span class=p>()</span>

    <span class=nx>client</span><span class=p>.</span><span class=nf>Publish</span><span class=p>(</span><span class=s>&#34;iot-device/input&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;WAKEUP&#34;</span><span class=p>)</span>

    <span class=c1>// Both assertions should be true within 500ms
</span><span class=c1></span>    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertAsync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span> <span class=k>return</span> <span class=nx>expect_to_be_awake</span> <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertAsync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span> <span class=k>return</span> <span class=nx>expect_to_download_config</span> <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>test_receives_ping</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Test</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>expected_response_received</span> <span class=o>:=</span> <span class=kc>false</span>

    <span class=nx>client</span><span class=p>.</span><span class=nf>Subscribe</span><span class=p>(</span><span class=s>&#34;iot-device/output&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Client</span><span class=p>,</span> <span class=nx>m</span> <span class=nx>mqtt</span><span class=p>.</span><span class=nx>Message</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>expected_response_received</span> <span class=p>=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>m</span><span class=p>.</span><span class=nf>Payload</span><span class=p>())</span> <span class=o>==</span> <span class=s>&#34;PING&#34;</span>
    <span class=p>}).</span><span class=nf>Wait</span><span class=p>()</span>

    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>expected_response_received</span>
    <span class=p>},</span> <span class=mi>1_000</span><span class=p>)</span>
<span class=p>}</span>

<span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>z</span><span class=p>.</span><span class=nf>Describe</span><span class=p>(</span><span class=s>&#34;IoT Device Commands&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Suite</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;wakes up on message&#34;</span><span class=p>,</span> <span class=nx>test_wakes_up_on_messages</span><span class=p>)</span>
        <span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;falls asleep on message&#34;</span><span class=p>,</span> <span class=nx>test_falls_asleep_on_message</span><span class=p>)</span>
    <span class=p>})</span>

    <span class=nx>z</span><span class=p>.</span><span class=nf>Describe</span><span class=p>(</span><span class=s>&#34;Diagnostics&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Suite</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;receives PING&#34;</span><span class=p>,</span> <span class=nx>test_receives_ping</span><span class=p>)</span>
    <span class=p>})</span>
<span class=p>}</span>
</code></pre></div><h2 id=reading-results>Reading results</h2>
<p>After every test ZARDOZ will provide a summary of the number of tests ran, passes, and failes.
When tests fail, ZARDOZ will provide a preview of the offending assertion and as well as the path and line number under the summary.</p>
<p>Example below:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=err>$</span> <span class=k>go</span> <span class=nx>run</span> <span class=o>*</span><span class=p>.</span><span class=k>go</span>

<span class=nx>Running</span><span class=o>...</span>
<span class=nx>FF</span>

<span class=nx>Failures</span><span class=p>:</span>

  <span class=mi>1</span><span class=p>)</span> <span class=nx>Example</span> <span class=nx>External</span> <span class=nx>System</span> <span class=nx>can</span> <span class=nx>turn</span> <span class=nx>on</span>

    <span class=nx>Never</span> <span class=nx>returned</span> <span class=kc>true</span> <span class=nx>after</span> <span class=mi>500</span><span class=nx>ms</span> <span class=nx>when</span> <span class=nx>evaluating</span><span class=p>:</span>
    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>expected_response_received</span>
    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>}</span>
  <span class=mi>2</span><span class=p>)</span> <span class=nx>Example</span> <span class=nx>External</span> <span class=nx>System</span> <span class=nx>can</span> <span class=nx>turn</span> <span class=nx>off</span>

    <span class=nx>Never</span> <span class=nx>returned</span> <span class=kc>true</span> <span class=nx>after</span> <span class=mi>500</span><span class=nx>ms</span> <span class=nx>when</span> <span class=nx>evaluating</span><span class=p>:</span>
    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>expected_response_received</span>
    <span class=p>},</span> <span class=mi>500</span><span class=p>)</span>
<span class=p>}</span>

<span class=nx>Assertion</span> <span class=nx>failed</span> <span class=o>/</span><span class=nx>Users</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>user</span><span class=o>/</span><span class=p>.</span><span class=k>go</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>tests</span><span class=o>/</span><span class=nx>v1</span><span class=o>/</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>18</span>
<span class=nx>Assertion</span> <span class=nx>failed</span> <span class=o>/</span><span class=nx>Users</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>user</span><span class=o>/</span><span class=p>.</span><span class=k>go</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>tests</span><span class=o>/</span><span class=nx>v1</span><span class=o>/</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>32</span>

<span class=mi>2</span> <span class=nx>tests</span> <span class=nx>ran</span> <span class=nx>with</span> <span class=mi>0</span> <span class=nx>passes</span> <span class=nx>and</span> <span class=mi>2</span> <span class=nx>failures</span><span class=p>.</span>

<span class=nx>Running</span><span class=o>...</span>
<span class=nx>F</span>

<span class=nx>Failures</span><span class=p>:</span>

  <span class=mi>1</span><span class=p>)</span> <span class=nx>Information</span> <span class=nx>about</span> <span class=nx>external</span> <span class=nx>system</span>

    <span class=nx>Never</span> <span class=nx>returned</span> <span class=kc>true</span> <span class=nx>after</span> <span class=mi>15000</span><span class=nx>ms</span> <span class=nx>when</span> <span class=nx>evaluating</span><span class=p>:</span>
    <span class=nx>t</span><span class=p>.</span><span class=nf>AssertSync</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=kt>bool</span> <span class=p>{</span>
        <span class=k>return</span> <span class=nx>expected_response_received</span>
    <span class=p>},</span> <span class=mi>15_000</span><span class=p>)</span>
<span class=p>}</span>

<span class=nx>Assertion</span> <span class=nx>failed</span> <span class=o>/</span><span class=nx>Users</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>user</span><span class=o>/</span><span class=p>.</span><span class=k>go</span><span class=o>/</span><span class=nx>src</span><span class=o>/</span><span class=nx>example</span><span class=o>-</span><span class=nx>tests</span><span class=o>/</span><span class=nx>v1</span><span class=o>/</span><span class=nx>main</span><span class=p>.</span><span class=k>go</span><span class=p>:</span><span class=mi>44</span>

<span class=mi>1</span> <span class=nx>tests</span> <span class=nx>ran</span> <span class=nx>with</span> <span class=mi>0</span> <span class=nx>passes</span> <span class=nx>and</span> <span class=mi>1</span> <span class=nx>failures</span><span class=p>.</span>
</code></pre></div><h2 id=setup-and-cleanup>Setup and Cleanup</h2>
<p>ZARDOZ allows you to run setup code or cleanup code, if you so wish. These are executed once per test.</p>
<ul>
<li><code>s.Setup</code> executed before the test.</li>
<li><code>s.Cleanup</code> executed after the test.</li>
</ul>
<p>Examples</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
  <span class=nx>z</span><span class=p>.</span><span class=nf>Describe</span><span class=p>(</span><span class=s>&#34;Example External System&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>z</span><span class=p>.</span><span class=nx>Suite</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>s</span><span class=p>.</span><span class=nf>Setup</span><span class=p>(</span><span class=kd>func</span> <span class=p>()</span> <span class=p>{</span>
          <span class=nf>setup_my_dependency</span><span class=p>()</span>
      <span class=p>})</span>
      
      <span class=c1>// or
</span><span class=c1></span>      
      <span class=nx>s</span><span class=p>.</span><span class=nf>Setup</span><span class=p>(</span><span class=nx>setup_my_dependency</span><span class=p>)</span>
      
      <span class=nx>s</span><span class=p>.</span><span class=nf>Test</span><span class=p>(</span><span class=s>&#34;can handle commands&#34;</span><span class=p>,</span> <span class=nx>test_some_command</span><span class=p>)</span>
      
      <span class=nx>s</span><span class=p>.</span><span class=nf>Cleanup</span><span class=p>(</span><span class=kd>func</span> <span class=p>()</span> <span class=p>{</span>
          <span class=nf>cleanup_my_dependency</span><span class=p>()</span>
      <span class=p>})</span>
      
      <span class=c1>// or
</span><span class=c1></span>      
      <span class=nx>s</span><span class=p>.</span><span class=nf>Cleanup</span><span class=p>(</span><span class=nx>cleanup_my_dependency</span><span class=p>)</span>
      
  <span class=p>})</span>
<span class=p>}</span>
</code></pre></div>
</div>
<div class=footer>
<div class=footer-social>
<span class="social-icon social-icon-github">
<a href=https://github.com/apiercey title=github target=_blank rel=noopener>
<img src=/images/social/github.svg width=24 height=24 alt=github>
</a>
</span>
<span class="social-icon social-icon-linkedin">
<a href=https://www.linkedin.com/in/alexander-butt-piercey title=linkedin target=_blank rel=noopener>
<img src=/images/social/linkedin.svg width=24 height=24 alt=linkedin>
</a>
</span>
</div>
</div>
</div>
<script type=text/javascript src=/js/bundle.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js></script>
</body>
</html>